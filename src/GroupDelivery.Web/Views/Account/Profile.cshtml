@{
    ViewData["Title"] = "我的檔案";
}

<style>
    body {
        background: linear-gradient(135deg, #fff7ed 0%, #f5f7fb 50%, #eef2ff 100%);
    }

    .profile-hero {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: #fff;
        border-radius: 22px;
        box-shadow: 0 25px 60px rgba(99,102,241,.35);
    }

    .profile-card, .profile-mini-card {
        border-radius: 20px;
        box-shadow: 0 18px 45px rgba(15,23,42,.08);
        border: 0;
    }

    .lift {
        transition: transform .2s ease, box-shadow .2s ease;
    }

        .lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,.12);
        }
</style>

<div id="app" class="container py-5"></div>

@section Scripts {
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    user: null,
                    loading: true,
                    saving: false
                }
            },
            async mounted() {
                const res = await axios.get('/Account/ProfileData');
                this.user = res.data;
                this.loading = false;
            },
            methods: {
                formatDate(d) {
                    if (!d) return '';
                    return new Date(d).toLocaleString();
                },
                async saveProfile() {
                    this.saving = true;
                    await axios.post('/Account/UpdateProfile', this.user);
                    this.saving = false;
                    alert("已儲存");
                }
            },
                    template: `
        <div v-if="loading" class="text-center py-5 text-muted">
            載入中...
        </div>

        <div v-else class="row justify-content-center">
        <div class="col-lg-7">

            <!-- HERO -->
            <div class="profile-hero p-4 mb-4 text-center">
                <img v-if="user.pictureUrl"
                     :src="user.pictureUrl"
                     class="rounded-circle mb-3"
                     style="width:90px;height:90px;object-fit:cover;">

                <h4 class="fw-bold">
                    {{ user.nickname || user.displayName }}
                </h4>

                <div class="small opacity-75">
                    {{ user.email }}
                </div>
            </div>

            <!-- 角色狀態卡片 -->
            <div class="profile-mini-card p-4 mb-4 text-center lift">

                <!-- 一般使用者 -->
                <div v-if="user.role === 1">
                    <h5 class="fw-bold mb-3">你目前是一般使用者</h5>
                    <p class="text-muted small mb-3">
                        升級為商家即可開始開團、管理菜單、提升曝光。
                    </p>

                    <a href="/Account/UpgradeToMerchant"
                       class="btn btn-warning w-100 py-3 fw-bold">
                       升級為商家
                    </a>
                </div>

                <!-- 商家 -->
                <div v-else-if="user.role === 2 ">
                    <h5 class="fw-bold mb-3">你目前是商家身份</h5>
                    <p class="text-muted small mb-3">
                        前往商家後台管理你的店鋪與團單。
                    </p>

                    <a href="/Store/MyStores"
                       class="btn btn-success w-100 py-3 fw-bold">
                       前往商家後台
                    </a>
                </div>

                <!-- 其他角色（預留） -->
                <div v-else>
                    <h5 class="fw-bold mb-3">系統角色：{{ user.role }}</h5>
                </div>

            </div>

            <!-- 基本可編輯資料（精簡版） -->
            <div class="profile-mini-card p-4 mb-3">
                <h6 class="fw-bold mb-3">基本資料</h6>

                <input class="form-control mb-2"
                       placeholder="手機"
                       v-model="user.phone">

                <input class="form-control mb-2"
                       placeholder="城市"
                       v-model="user.city">

                <textarea class="form-control"
                          rows="2"
                          placeholder="自我介紹"
                          v-model="user.bio"></textarea>
            </div>

            <button class="btn btn-primary w-100 py-3 fw-bold"
                    :disabled="saving"
                    v-on:click="saveProfile">
                儲存
            </button>

        </div>
        </div>
        `

        }).mount('#app');
    </script>
}
