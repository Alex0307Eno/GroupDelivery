@{
    ViewData["Title"] = "揪IN｜商家開團";
}

<style>
    .fade-up {
        animation: fadeUp .6s ease both;
    }

    .fade-delay-1 {
        animation-delay: .1s;
    }

    .fade-delay-2 {
        animation-delay: .2s;
    }

    .fade-delay-3 {
        animation-delay: .3s;
    }

    @@keyframes fadeUp {
        from {
            opacity: 0;
            transform: translateY(16px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .compare-box {
        background: #f8fafc;
        border-radius: 1rem;
        padding: 1.2rem;
        font-size: .9rem;
        margin-top: 1.5rem;
    }

        .compare-box strong {
            color: #111827;
        }

    .hint-strong {
        font-size: .9rem;
        font-weight: 700;
        margin-top: .4rem;
    }
</style>

<div id="app" class="container py-5">

    <div class="create-wrap">

        <!-- HERO -->
        <div class="hero-box fade-up">
            <div class="hero-title">
                開一團，<br />
                只送「值得送」的訂單
            </div>
            <div class="hero-sub">
                人沒湊齊就不出單，成本你說了算
            </div>
        </div>

        <!-- FORM -->
        <div class="card-box fade-up fade-delay-1">

            <!-- 店家 -->
            <div class="mb-4">
                <label class="form-label">店家</label>
                <input class="form-control shadow-sm"
                       :value="storeName"
                       disabled>
                <div class="form-hint">
                    已登入商家帳號
                </div>
            </div>

            <div class="divider"></div>

            <!-- 成團金額 -->
            <div class="mb-4">
                <label class="form-label">成團金額</label>
                <div class="form-hint">
                    沒達標就不會出單
                </div>

                <div class="input-group shadow-sm">
                    <span class="input-group-text">$</span>
                    <input type="number"
                           class="form-control"
                           v-model.number="form.targetAmount"
                           placeholder="例如：800">
                </div>

                <div v-if="targetHint"
                     class="hint-strong text-primary">
                    {{ targetHint }}
                </div>
            </div>

            <!-- 截止時間 -->
            <div class="mb-4 fade-up fade-delay-2">
                <label class="form-label">截止時間</label>
                <div class="form-hint">
                    建議 30～90 分鐘
                </div>
                <input type="datetime-local"
                       class="form-control shadow-sm"
                       v-model="form.deadline">
            </div>

            <!-- 外送距離 -->
            <div class="mb-4 fade-up fade-delay-3">
                <label class="form-label">外送距離上限（公里）</label>
                <div class="form-hint">
                    只通知會來的人
                </div>
                <input type="number"
                       class="form-control shadow-sm"
                       v-model.number="form.deliveryRange">
            </div>

            <!-- 備註 -->
            <div class="mb-4">
                <label class="form-label">團購說明（選填）</label>
                <textarea class="form-control shadow-sm"
                          rows="3"
                          v-model="form.remark"></textarea>
            </div>

            <!-- 差異對比 -->
            <div class="compare-box">
                <strong>揪 IN 跟外送平台差在哪？</strong>
                <ul class="mt-2 mb-0 ps-3">
                    <li>外送平台：一單也得送</li>
                    <li><strong>揪 IN：人沒湊齊，不出單</strong></li>
                    <li class="mt-1">外送平台：抽成固定</li>
                    <li><strong>揪 IN：條件你先決定</strong></li>
                </ul>
            </div>

            <!-- CTA -->
            <button class="btn btn-primary w-100 submit-btn mt-4"
                    :disabled="submitting"
                    @@click="submitForm">
                {{ submitting ? '建立中…' : '建立湊單團' }}
            </button>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    storeName: "梁社漢排骨",
                    submitting: false,
                    form: {
                        targetAmount: null,
                        deadline: "",
                        deliveryRange: 3,
                        remark: ""
                    }
                }
            },
            computed: {
                targetHint() {
                    if (!this.form.targetAmount) return "";
                    if (this.form.targetAmount < 500)
                        return "金額偏低，可能很快成團";
                    if (this.form.targetAmount < 1000)
                        return "常見設定，轉換率穩定";
                    return "金額偏高，建議搭配推播";
                }
            },
            methods: {
                submitForm() {
                    if (!this.form.targetAmount || !this.form.deadline) {
                        alert("請填寫成團金額與截止時間");
                        return;
                    }

                    this.submitting = true;

                    axios.post('/api/merchant/groups', this.form)
                        .then(() => {
                            location.href = "/Merchant/Dashboard";
                        })
                        .catch(() => {
                            alert("建立失敗，請稍後再試");
                        })
                        .finally(() => {
                            this.submitting = false;
                        });
                }
            }
        }).mount('#app');
    </script>
}
